% class 2017-12-04
% linear shooting method
% page 674

clear;
close all;

a = 1;
b = 2;

ya = 1;
yb = 2;

N = 9;

h = (b-a)/N;

% syms x y yp
% sym_ypp = symfun(-2*yp/x + 2*y/x^2 + sin(log(x))/x^2, [x,y,yp]);
% ypp = matlabFunction(sym_ypp);

p = @(x) 2/x;
q = @(x) 2/x^2;
r = @(x)  sin(log(x))/x^2;

u(1,1) = ya;
u(2,1) = 0;
v(1,1) = 0;
v(2,1) = 0;

xout(1) = ya;

for i=1:N
    x = a + i*h;
    xout(i+1) = x;
    
    k(1,1) = h * u(2,i);
    k(1,2) = h * (p(x)*u(2,i) + q(x)*u(1,i) + r(x));
    k(2,1) = h * (u(2,i) + 0.5*k(1,2) );
    k(2,2) = h * ( p(x+h/2)*(u(2,i)+0.5*k(1,2)) + q(x+h/2)*(u(1,i)+0.5*k(1,1))+r(x+h/2) );   
    k(3,1) = h * (u(2,i) + 0.5*k(2,2));
    k(3,2) = h * ( p(x+h/2)*(u(2,i)+0.5*k(2,2)) + q(x+h/2)*(u(1,i)+0.5*k(2,1))+r(x+h/2) );   
    k(4,1) = h * (u(2,i)+k(3,2));
    k(4,2) = h * ( p(x+h/2)*(u(2,i)+k(3,2)) + q(x+h/2)*(u(1,i)+k(3,1)) + r(x+h/2) ); 
    
    u(1,i+1) = u(1,i) + (k(1,1) + 2*k(2,1) + 2*k(3,1)+k(4,1))/6;
    u(2,i+1) = u(2,i) + (k(1,2) + 2*k(2,2) + 2*k(3,2)+k(4,2))/6;
    
    kp(1,1) = h * v(2,i);
    kp(1,2) = h * (p(x)*v(2,i) + q(x)*u(1,i));
    kp(2,1) = h * (v(2,i) + 0.5*kp(1,2) );
    kp(2,2) = h * ( p(x+h/2)*(v(2,i)+0.5*kp(1,2)) + q(x+h/2)*(v(1,i)+0.5*k(1,1)) );   
    kp(3,1) = h * (v(2,i) + 0.5*kp(2,2));
    kp(3,2) = h * ( p(x+h/2)*(v(2,i)+0.5*kp(2,2)) + q(x+h/2)*(v(1,i)+0.5*kp(2,1)) );  
    kp(4,1) = h * (v(2,i)+kp(3,2));
    kp(4,2) = h * ( p(x+h/2)*(v(2,i)+kp(3,2)) + q(x+h/2)*(v(1,i)+kp(3,1)) ); 
    
    v(1,i+1) = v(1,i) + (kp(1,1) + 2*kp(2,1) + 2*kp(3,1)+kp(4,1))/6;
    v(2,i+1) = v(2,i) + (kp(1,2) + 2*kp(2,2) + 2*kp(3,2)+kp(4,2))/6;
    
end

w(1,1) = ya;
w(2,1) = (yb - u(1,N)) / v(1,N);

for i=2:N+1
    w(1,i) = u(1,i) + w(2,1)*v(1,i);
    w(2,i) = u(2,i) + w(2,1)*v(2,i);
end




