% class 2017-12-04
% linear shooting method
% page 674


function [x, w1, w2] = linear_shooting(p, q, r, aa, bb, ya, yb, N)

    h = (bb-aa)/(N);

    u1(1) = ya;
    u2(1) = 0;
    v1(1) = 0;
    v2(1) = 1;

    for i=1:N
        x = aa + i*h;

        k(1,1) = h * u2(i);
        k(1,2) = h * (p(x)*u2(i) + q(x)*u1(i) + r(x));
        k(2,1) = h * (u2(i) + 0.5*k(1,2) );
        k(2,2) = h * ( p(x+h/2)*(u2(i)+0.5*k(1,2)) + q(x+h/2)*(u1(i)+0.5*k(1,1))+r(x+h/2) );   
        k(3,1) = h * (u2(i) + 0.5*k(2,2));
        k(3,2) = h * ( p(x+h/2)*(u2(i)+0.5*k(2,2)) + q(x+h/2)*(u1(i)+0.5*k(2,1))+r(x+h/2) );   
        k(4,1) = h * (u2(i)+k(3,2));
        k(4,2) = h * ( p(x+h)*(u2(i)+k(3,2)) + q(x+h)*(u1(i)+k(3,1)) + r(x+h) ); 

        u1(i+1) = u1(i) + (k(1,1) + 2*k(2,1) + 2*k(3,1) + k(4,1)) / 6;
        u2(i+1) = u2(i) + (k(1,2) + 2*k(2,2) + 2*k(3,2) + k(4,2)) / 6;

        kp(1,1) = h * v2(i);
        kp(1,2) = h * (p(x)*v2(i) + q(x)*v1(i));
        kp(2,1) = h * (v2(i) + 0.5*kp(1,2) );
        kp(2,2) = h * ( p(x+h/2)*(v2(i)+0.5*kp(1,2)) + q(x+h/2)*(v1(i)+0.5*kp(1,1)) );   
        kp(3,1) = h * (v2(i) + 0.5*kp(2,2));
        kp(3,2) = h * ( p(x+h/2)*(v2(i)+0.5*kp(2,2)) + q(x+h/2)*(v1(i)+0.5*kp(2,1)) );  
        kp(4,1) = h * (v2(i)+kp(3,2));
        kp(4,2) = h * ( p(x+h)*(v2(i)+kp(3,2)) + q(x+h)*(v1(i)+kp(3,1)) ); 

        v1(i+1) = v1(i) + (kp(1,1) + 2*kp(2,1) + 2*kp(3,1) + kp(4,1)) / 6;
        v2(i+1) = v2(i) + (kp(1,2) + 2*kp(2,2) + 2*kp(3,2) + kp(4,2)) / 6;

    end

    w1(1) = ya;
    w2(1) = (yb - u1(N+1)) / v1(N+1);

    for i=2:N+1
        w1(i) = u1(i) + w2(1)*v1(i);
        w2(i) = u2(i) + w2(1)*v2(i);
    end

    x = ya:h:yb;

end

